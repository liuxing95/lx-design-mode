# 发布订阅模式

发布 - 订阅模式 （Publish-Subscribe Pattern, pub-sub）又叫观察者模式（Observer Pattern），它定义了一种一对多的关系，让多个订阅者对象同时监听某一个发布者，或者叫主题对象，这个主题对象的状态发生变化时就会通知所有订阅自己的订阅者对象，使得它们能够自动更新自己。


## 1.  发布订阅模式的通用实现
`addEventListener`

<b>主要概念如下</b>

1.  Publisher ： 发布者， 当消息发生时负责通知对应订阅者
2.  Subscriber ： 订阅者，当消息发生时被通知的对象
3.  SubscriberMap ：持有不同type的数组， 存储所有订阅者的数组
4.  type ： 消息类型 订阅者可以订阅的不用消息类型
5.  subscribe ： 该方法为订阅者添加到 SubscriberMap 中对应的数组中
6.  unSubscribe: 该方法为在 SubscriberMap 中删除订阅者
7.  notify : 该方法遍历通知 SubscriberMap 中对应 type 的每个订阅者

<img src="https://cdn.nlark.com/yuque/0/2020/jpeg/140909/1587018120750-718be048-0b02-4a30-9feb-cdf31cea222c.jpeg?x-oss-process=image%2Fresize%2Cw_746" />

代码实现 `publisher.ts`


## 2. 实战中的发布-订阅模式

### 2.1  使用jQuery 的方式

我们使用 jQuery 的时候可以通过其自带的 API 比如 on、trigger、off 来轻松实现事件的订阅、发布、取消订阅等操作：


### 2.2 使用Vue 的 EventBus


## 3. 发布-订阅模式的优缺点
解耦：

1.  时间上的解耦： 注册的订阅行为由消息的发布方来决定何时调用，订阅者不用持续关注，当消息发生时发布者会负责通知
2.  对象上的解耦： 发布者不用提前知道消息的接受者是谁，发布者只需要遍历处理所有订阅该消息类型的订阅者发送消息即可（迭代器模式），由此解耦了发布者和订阅者之间的联系，互不持有， 都依赖于抽象， 不再依赖于具体


发布 - 订阅模式也有缺点：
1. 增加消耗 ：创建结构和缓存订阅者这两个过程需要消耗计算和内存资源，即使订阅后始终没有触发，订阅者也会始终存在于内存；
2. 增加复杂度 ：订阅者被缓存在一起，如果多个订阅者和发布者层层嵌套，那么程序将变得难以追踪和调试，参考一下 Vue 调试的时候你点开原型链时看到的那堆 deps/subs/watchers 们…